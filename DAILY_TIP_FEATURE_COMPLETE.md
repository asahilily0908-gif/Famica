# 「行動のヒント」機能実装完了レポート

**日時**: 2026年1月24日  
**機能**: 日替わり行動のヒントカード  
**目的**: サブスクリプション削除後の代替機能として、軽量でオフライン動作する1日1つのヒントを提供

---

## 実装内容

### 📋 機能仕様

✅ **完全オフライン動作**
- FirestoreやAPIを一切使用しない
- ハードコードされた50個のヒントデータ
- UTC日付ベースの決定論的選択

✅ **全ユーザー統一**
- 同じ日に全ユーザーが同じヒントを見る
- 2024年1月1日からの経過日数で計算
- 50日周期で循環

✅ **UIデザイン**
- 柔らかい紫色のグラデーションカード
- タイトル: 「行動のヒント」（固定）
- カテゴリバッジ表示（キッチン/お部屋/衣類）
- 電球アイコン付き

---

## 作成ファイル

### 1. `lib/data/daily_tips.dart`
**役割**: ヒントデータの定義

```dart
class DailyTip {
  final String category;
  final String body;
}

const List<DailyTip> dailyTips = [
  // 50個のヒント（キッチン20 / お部屋20 / 衣類10）
];
```

**ヒント内容**:
- キッチン: レンジの汚れ、鍋の焦げ付き、排水口のヌメリなど20項目
- お部屋: 窓の掃除、家具のホコリ、カーペットの毛など20項目
- 衣類: 乾燥を時短、軽いシワ、靴の消臭など10項目

### 2. `lib/utils/daily_tip_picker.dart`
**役割**: 日替わりヒント選択ロジック

```dart
DailyTip getTodayTip() {
  final now = DateTime.now().toUtc();
  final epoch = DateTime.utc(2024, 1, 1);
  
  // 2024/1/1からの経過日数を計算
  final daysSinceEpoch = now.difference(epoch).inDays;
  
  // ヒント配列のインデックスを決定（循環）
  final index = daysSinceEpoch % dailyTips.length;
  
  return dailyTips[index];
}
```

**特徴**:
- UTC時刻使用で全ユーザー統一
- モジュロ演算で50日周期循環
- タイムゾーン非依存

### 3. `lib/widgets/daily_tip_card.dart`
**役割**: 紫色のヒントカードUI

**デザイン**:
- グラデーション: `#A78BFA` → `#9F7AEA`（柔らかいラベンダー）
- 角丸: 20px
- シャドウ: ラベンダー色の柔らかい影
- アイコン: 電球（`Icons.lightbulb_outline`）
- カテゴリバッジ: 半透明の白背景

**構成**:
```
┌─────────────────────────────────────┐
│ 💡 行動のヒント          [カテゴリ] │
│                                     │
│ レンジの汚れ：コップ1杯のレモン水... │
└─────────────────────────────────────┘
```

---

## 統合箇所

### `lib/screens/couple_screen.dart`

**配置位置**: ヘッダーと円グラフの間
```dart
children: [
  _buildHeader(),
  const DailyTipCard(),  // ← 追加
  _buildPieChartSection(month),
  // ...
],
```

**表示順序**:
1. Famicaヘッダー
2. 🔮 **行動のヒント**（NEW!）
3. 円グラフ
4. 感謝メッセージ
5. メンバー統計
6. 6ヶ月推移

---

## 技術的詳細

### 日付計算の仕組み

```dart
// 例: 2026年1月24日の場合
DateTime.now().toUtc()  // 2026-01-24 (UTC)
  .difference(DateTime.utc(2024, 1, 1))  // 753日
  .inDays % 50  // 753 % 50 = 3

// → dailyTips[3] が選択される
```

### なぜUTCを使うのか？

- **ローカル時刻の問題**: タイムゾーンによって異なる日付になる
- **UTC使用**: 世界中どこでも同じヒントが表示される
- **日付変更**: UTC 00:00で全ユーザー一斉に切り替わる

### 50日周期の選定理由

- 十分なバリエーション（約1.7ヶ月）
- メンテナンス可能な数
- 追加・変更が容易

---

## ビルド確認

### ✅ 静的解析
```bash
flutter analyze
```
**結果**: エラーなし（既存のwarningsのみ）

### ✅ ファイル構成
```
lib/
├── data/
│   └── daily_tips.dart          # NEW
├── utils/
│   └── daily_tip_picker.dart    # NEW
├── widgets/
│   └── daily_tip_card.dart      # NEW
└── screens/
    └── couple_screen.dart       # MODIFIED
```

---

## AI/Plus参照の確認

### 🔍 確認済み
```bash
grep -r "ai.*coach\|AICoach" lib/screens/*.dart
# 結果: 0件（完全削除済み）
```

### ✅ クリーンな実装
- AI機能への参照なし
- Plus機能への参照なし
- サブスクリプション関連コードなし
- 純粋なハードコードデータのみ

---

## 今後の拡張性

### ヒントの追加方法
1. `lib/data/daily_tips.dart`を開く
2. `dailyTips`リストに追加:
```dart
DailyTip(
  category: 'キッチン',
  body: '新しいヒント内容...',
),
```
3. 自動的に循環に組み込まれる

### カテゴリの追加
カテゴリ文字列は自由に設定可能:
- 現在: `キッチン` / `お部屋` / `衣類`
- 追加例: `お金` / `健康` / `時短` など

---

## まとめ

### ✅ 達成した要件
- [x] 1日1つのヒントを表示
- [x] 全ユーザーが同じ日に同じヒントを見る
- [x] Firestore不使用
- [x] 外部API不使用
- [x] AI生成なし
- [x] 50個のヒントをハードコード
- [x] 紫色のカードデザイン
- [x] タイトル「行動のヒント」
- [x] ホーム画面（CoupleScreen）に配置
- [x] AI/Plus/サブスクリプション参照なし

### 🎨 UI特徴
- 柔らかい紫色のグラデーション
- 電球アイコン
- カテゴリバッジ
- モダンで洗練されたデザイン
- 既存UIとの調和

### ⚡ パフォーマンス
- 完全オフライン動作
- ネットワーク不要
- 即座に表示
- メモリ使用量最小

---

**実装日**: 2026年1月24日 00:03  
**ステータス**: ✅ 完了  
**次のステップ**: アプリをビルドして動作確認
